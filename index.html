<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FUJITA MUSEUM QUIZ - FIXED</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #f0f0f0;
            --card-bg: #ffffff;
            --text-main: #2c2c2c;
            --accent: #8c7b75;
            --highlight: #bfa46f;
            --correct: #2e7d32; /* 濃い緑 */
            --correct-bg: #e8f5e9;
            --wrong: #c62828;   /* 濃い赤 */
            --wrong-bg: #ffebee;
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Noto Serif JP', serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            line-height: 1.8;
        }

        .container {
            width: 100%;
            max-width: 640px;
            background: var(--card-bg);
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            border-radius: 8px;
        }

        /* ヘッダー */
        header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 1px solid #eee;
            padding-bottom: 20px;
        }
        
        h1 { font-size: 1.5rem; letter-spacing: 0.2em; margin: 0; font-weight: 500; }
        .subtitle { font-size: 0.8rem; color: var(--accent); letter-spacing: 0.1em; margin-top: 5px; }

        /* 画面切り替え */
        .screen { display: none; }
        .screen.active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* クイズ画面 */
        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            font-size: 0.8rem;
            color: var(--accent);
        }

        .category-tag {
            background: #eee;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: bold;
        }

        .question {
            font-size: 1.2rem;
            font-weight: 500;
            margin-bottom: 30px;
            min-height: 80px;
        }

        /* 選択肢ボタン */
        .options { display: grid; gap: 12px; }

        .btn {
            background: transparent;
            border: 1px solid #ddd;
            padding: 15px 20px;
            text-align: left;
            font-family: inherit;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            border-radius: 4px;
            color: var(--text-main);
            position: relative;
            width: 100%;
        }

        .btn:hover {
            background: #fafafa;
            border-color: var(--accent);
        }

        /* ★ここを修正: 色の反映を強制 (!important) */
        .btn.correct-ans {
            background-color: var(--correct) !important;
            border-color: var(--correct) !important;
            color: white !important;
            font-weight: bold;
        }
        
        /* 正解マーク */
        .btn.correct-ans::after {
            content: "⭕️";
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
        }

        .btn.wrong-ans {
            background-color: var(--wrong) !important;
            border-color: var(--wrong) !important;
            color: white !important;
            opacity: 0.6;
        }
        
        /* 不正解マーク */
        .btn.wrong-ans::after {
            content: "❌";
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
        }

        /* 選択後はクリック不可にする */
        .options.disabled-all .btn {
            pointer-events: none;
        }

        /* 判定表示エリア */
        #result-indicator {
            text-align: center;
            font-size: 1.4rem;
            font-weight: bold;
            margin: 20px 0;
            padding: 10px;
            border-radius: 4px;
            display: none;
        }
        .res-correct { color: var(--correct); background: var(--correct-bg); border: 1px solid var(--correct); }
        .res-wrong { color: var(--wrong); background: var(--wrong-bg); border: 1px solid var(--wrong); }

        /* 解説エリア */
        .explanation {
            margin-top: 15px;
            padding: 20px;
            background: #f9f9f9;
            border-left: 5px solid #ccc;
            display: none;
            font-size: 0.9rem;
        }

        .explanation.is-correct { border-left-color: var(--correct); background-color: var(--correct-bg); }
        .explanation.is-wrong { border-left-color: var(--wrong); background-color: var(--wrong-bg); }

        .exp-title { display: block; font-weight: bold; margin-bottom: 5px; }
        .source { display: block; text-align: right; font-size: 0.75rem; color: #999; margin-top: 10px; font-style: italic; }

        /* ボタン */
        .action-btn {
            display: block;
            width: 100%;
            padding: 15px;
            margin-top: 20px;
            background: var(--text-main);
            color: white;
            border: none;
            font-size: 1rem;
            cursor: pointer;
            text-align: center;
            border-radius: 4px;
        }
        .action-btn:hover { opacity: 0.9; }

        /* 結果画面 */
        .result-score { font-size: 4rem; text-align: center; color: var(--highlight); margin: 20px 0; }
        .result-msg { text-align: center; margin-bottom: 30px; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>FUJITA MUSEUM</h1>
        <div class="subtitle">Art & Knowledge Quiz</div>
    </header>

    <div id="start-screen" class="screen active">
        <p style="text-align: center; margin-bottom: 30px;">
            藤田美術館の全領域からランダムに出題。<br>
            あなたの知識を試してみましょう。
        </p>
        <button class="action-btn" onclick="app.start()">START QUIZ</button>
    </div>

    <div id="quiz-screen" class="screen">
        <div class="quiz-header">
            <span id="progress">Q 1</span>
            <span id="category" class="category-tag">Category</span>
        </div>
        
        <div id="question-text" class="question">Loading...</div>
        
        <div id="options-container" class="options"></div>

        <div id="result-indicator"></div>
        
        <div id="explanation-box" class="explanation">
            <span class="exp-title">解説</span>
            <span id="exp-text"></span>
            <span id="exp-source" class="source"></span>
        </div>

        <button id="next-btn" class="action-btn" style="display:none;" onclick="app.next()">次へ</button>
    </div>

    <div id="result-screen" class="screen">
        <h2 style="text-align:center;">RESULT</h2>
        <div id="score-display" class="result-score">0</div>
        <p id="result-comment" class="result-msg"></p>
        <button class="action-btn" onclick="app.reset()">もう一度挑戦する</button>
    </div>
</div>

<script>
/* 問題データ (サンプル) */
const quizData = [
    { category: "入門50選", q: "茶道において「茶入」とは、主に何を入れるための道具？", a: ["濃茶", "薄茶", "お湯", "お菓子"], correct: 0, exp: "茶入は、抹茶の中でも「濃茶」を入れるための陶製などの小壺です。", source: "入門50選" },
    { category: "蔵出50選", q: "国宝「曜変天目茶碗」。器の内側に現れる斑紋は何と呼ばれる？", a: ["星紋", "曜変", "油滴", "禾目"], correct: 1, exp: "光彩が輝くその様子から「曜変」と呼ばれます。", source: "蔵出50選" },
    { category: "ART TALK", q: "野々村仁清の「色絵藤花茶壺」。仁清の特徴である成形方法は？", a: ["ロクロ成形", "手びねり", "型押し", "鋳造"], correct: 0, exp: "仁清はロクロの名手であり、極めて薄く均整の取れた陶器を作りました。", source: "ART TALK" },
    { category: "施設", q: "「あみじま茶屋」のだんごは、どのように提供される？", a: ["その場で焼いて提供", "冷凍で提供", "作り置き", "真空パック"], correct: 0, exp: "注文を受けてから目の前で焼き、温かい状態で提供しています。", source: "あみじま茶屋" },
    { category: "歴史", q: "藤田美術館の創設者・藤田傳三郎の号は？", a: ["香雪", "鈍翁", "耳庵", "三渓"], correct: 0, exp: "藤田傳三郎は「香雪」と号しました。", source: "美術館の歴史" }
];

const app = {
    questions: [],
    index: 0,
    score: 0,
    MAX_Q: 5, // 出題数

    start: function() {
        // 画面リセット
        document.querySelectorAll('.screen').forEach(el => el.classList.remove('active'));
        document.getElementById('quiz-screen').classList.add('active');

        // データシャッフル
        this.questions = this.shuffle([...quizData]).slice(0, this.MAX_Q);
        this.index = 0;
        this.score = 0;
        this.loadQ();
    },

    loadQ: function() {
        const data = this.questions[this.index];
        
        // テキストセット
        document.getElementById('progress').innerText = `Q ${this.index + 1} / ${this.MAX_Q}`;
        document.getElementById('category').innerText = data.category;
        document.getElementById('question-text').innerText = data.q;

        // 表示リセット
        document.getElementById('explanation-box').style.display = 'none';
        document.getElementById('explanation-box').className = 'explanation'; 
        document.getElementById('result-indicator').style.display = 'none';
        document.getElementById('next-btn').style.display = 'none';
        
        // 選択肢コンテナ
        const container = document.getElementById('options-container');
        container.className = 'options'; // disabled-allを削除
        container.innerHTML = '';

        // ボタン生成
        data.a.forEach((ans, i) => {
            const btn = document.createElement('button');
            btn.className = 'btn';
            btn.innerText = ans;
            btn.onclick = () => this.check(i, btn);
            container.appendChild(btn);
        });
    },

    check: function(choiceIndex, btnElement) {
        const data = this.questions[this.index];
        const container = document.getElementById('options-container');
        const buttons = container.querySelectorAll('.btn');
        const indicator = document.getElementById('result-indicator');
        const expBox = document.getElementById('explanation-box');

        // 二重クリック防止
        container.classList.add('disabled-all');

        if (choiceIndex === data.correct) {
            // 正解
            this.score++;
            btnElement.classList.add('correct-ans'); // 緑にする
            
            indicator.innerHTML = "⭕️ 正解！";
            indicator.className = "res-correct";
            indicator.style.display = "block";
            
            expBox.classList.add('is-correct');
        } else {
            // 不正解
            btnElement.classList.add('wrong-ans'); // 赤にする
            buttons[data.correct].classList.add('correct-ans'); // 正解を緑にする
            
            indicator.innerHTML = "❌ 残念…";
            indicator.className = "res-wrong";
            indicator.style.display = "block";
            
            expBox.classList.add('is-wrong');
        }

        // 解説表示
        document.getElementById('exp-text').innerText = data.exp;
        document.getElementById('exp-source').innerText = `出典: ${data.source}`;
        expBox.style.display = 'block';

        // 次へボタン
        const nextBtn = document.getElementById('next-btn');
        nextBtn.style.display = 'block';
        nextBtn.innerText = (this.index === this.MAX_Q - 1) ? "結果を見る" : "次の問題へ";
    },

    next: function() {
        this.index++;
        if (this.index < this.MAX_Q) {
            this.loadQ();
        } else {
            this.showResult();
        }
    },

    showResult: function() {
        document.querySelectorAll('.screen').forEach(el => el.classList.remove('active'));
        document.getElementById('result-screen').classList.add('active');
        
        document.getElementById('score-display').innerText = `${this.score} / ${this.MAX_Q}`;
        
        const msg = document.getElementById('result-comment');
        if (this.score === this.MAX_Q) msg.innerText = "完璧です！素晴らしい知識！";
        else if (this.score >= this.MAX_Q * 0.7) msg.innerText = "惜しい！あと少しです。";
        else msg.innerText = "また挑戦して知識を深めましょう。";
    },

    reset: function() {
        this.start();
    },

    shuffle: function(arr) {
        return arr.sort(() => Math.random() - 0.5);
    }
};
</script>

</body>
</html>